{% extends "flags/base.html" %}
{% load flags_tags %}

{% block content %}


<main class="container">

  <div class="my-3 p-3 bg-white rounded shadow-sm">
    <h6 class="border-bottom border-gray pb-2 mb-0">Filtering</h6>

    <form method="get">
      {% csrf_token %}
      <div class="form-row">
        <div class="col">
        <h4>Tender's start date</h4>
          <div class="form-row">
            <div class="form-group col-md-6">
              {{ filter.form.start_date_from }}
            </div>
            <div class="form-group col-md-6">
              {{ filter.form.start_date_to }}
            </div>
          </div>
        </div>
        <div class="col">
          <h4>Tender's end date</h4>
          <div class="form-row">
            <div class="form-group col-md-6">
              {{ filter.form.end_date_from }}
            </div>
            <div class="form-group col-md-6">
              {{ filter.form.end_date_to }}
            </div>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col">
          <div class="form-group">
            <label for="inputProcuringEntity">Procuring entity</label>
            {{ filter.form.procuring_entity }}
            {% get_all_entities as entities %}
            <datalist id="entitiesList">
              {% for entity in entities %}
              <option value="{{ entity }}">
              {% endfor %}
            </datalist>
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label for="inputFlagType">Flag type</label>
            {{ filter.form.flag }}
            {% get_flag_types as flag_types %}
            <datalist id="flagsList">
              {% for flag_type in flag_types %}
              <option value="{{ flag_type.name }}">{{ flag_type.id }}</option>
              {% endfor %}
            </datalist>
          </div>
        </div>
      </div>

      <small class="d-block text-right mt-3">
        <input type="submit" class="btn btn-primary btn-sm" value="–ò—Å–∫–∞—Ç—å">
      </small>
    </form>
    <a href="{% url 'home' %}"><button class="btn btn-primary btn-sm">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button></a>
  </div>

<div class="my-3 p-3 bg-white rounded shadow-sm">


<!--Pagination-->
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
  {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?{% param_replace page=1 %}">&laquo;</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?{% param_replace page=page_obj.previous_page_number %}">&lsaquo;</a>
    </li>
  {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="?page=1">&laquo;</a>
    </li>
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="True">&lsaquo;</a>
    </li>
  {% endif %}

  {% if page_obj.number|add:'-4' > 1 %}
    <li class="page-item"><a class="page-link" href="?{% param_replace page=page_obj.number|add:'-5' %}">&hellip;</a></li>
  {% endif %}

  {% for i in page_obj.paginator.page_range %}
    {% if page_obj.number == i %}
    <li class="page-item active" aria-current="page">
      <span class="page-link">
        {{ i }}
        <span class="sr-only">(current)</span>
      </span>
    </li>
    {% elif i > page_obj.number|add:'-5' and i < page_obj.number|add:'5' %}
      <li class="page-item"><a class="page-link" href="?{% param_replace page=i %}">{{ i }}</a></li>
    {% endif %}
  {% endfor %}

  {% if page_obj.paginator.num_pages > page_obj.number|add:'4' %}
    <li class="page-item"><a class="page-link" href="?{% param_replace page=page_obj.number|add:'5' %}">&hellip;</a></li>

  {% endif %}

  {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?{% param_replace page=page_obj.next_page_number %}">&rsaquo;</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?{% param_replace page=paginator.num_pages %}">&raquo;</a>
    </li>
  {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="True">&rsaquo;</a>
    </li>
    <li class="page-item disabled">
      <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">&raquo;</a>
    </li>
  {% endif %}
    <li class="page-item disabled"><a class="page-link">
      –í—Å–µ–≥–æ {{ page_obj.paginator.num_pages }}
    </a>

    </li>
  </ul>
</nav>
<!--End of pagination-->
        <div class="table table-hover table-responsive rounded">
          <table class="table table-bordered table-sm">
            <thead class="table-dark">
              <tr>
                <th data-column="procuring_entity" data-order="desc">procuring entity</th>
                <th>tender</th>
                <th>status</th>
                <th>method</th>
                <th>price</th>
                <th data-column="start_date" data-order="desc">start date</th>
                <th>end date</th>
                <th>flags</th>
              </tr>
            </thead>
            <tbody>
              {% for tender in object_list %}
              {% get_flags tender.id as flags %}
              {% flags_num flags as flag_amount %}
              {% split_description tender.description as description_list %}
              <tr data-toggle="collapse" data-target="#accordion_id_{{ tender.id }}" class="accordion-toggle">
                <td>{{tender.procuring_entity}}</td>
                <td><a href="{{tender.url}}">{{tender.name}}</a></td>
                <td>{{ description_list.0 }}</td>
                <td>{{ description_list.1 }}</td>
                <td>{{ description_list.2 }}</td>
                <td>{{tender.start_time}}</td>
                <td>{{tender.end_time}}</td>
                <td>{{flag_amount}}</td>
              </tr>
              <tr>
                <td colspan="9" class="hiddenRow">
                  <div class="accordion-body collapse" id="accordion_id_{{ tender.id }}">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>flag</th>
                          <th>lot</th>
                          <th>lot's price</th>
                          <th>flag's date</th>
                          <th>details</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for flag_item in flags %}
                          <tr>
                            <td>{{ flag_item.irregularity }}</td>
                            <td>{{ flag_item.lot }}, {{ flag_item.lot.description }}</td>
                            <td>{{ flag_item.lot.price }}</td>
                            <td></td>
                            <td><a href="/details/{{ flag_item.pk }}">
                              <button type="button" class="btn btn-sm btn-outline-primary">
                              üëÅ
                              </button>
                            </a></td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

<!--Pagination-->
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
  {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page=1">First</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
    </li>
  {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="?page=1">First</a>
    </li>
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
    </li>
  {% endif %}

  {% if page_obj.number|add:'-4' > 1 %}
    <li class="page-item"><a class="page-link" href="?page={{ page_obj.number|add:'-5' }}">&hellip;</a></li>
  {% endif %}

  {% for i in page_obj.paginator.page_range %}
    {% if page_obj.number == i %}
    <li class="page-item active" aria-current="page">
      <span class="page-link">
        {{ i }}
        <span class="sr-only">(current)</span>
      </span>
    </li>
    {% elif i > page_obj.number|add:'-5' and i < page_obj.number|add:'5' %}
      <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
    {% endif %}
  {% endfor %}

  {% if page_obj.paginator.num_pages > page_obj.number|add:'4' %}
    <li class="page-item"><a class="page-link" href="?page={{ page_obj.number|add:'5' }}">&hellip;</a></li>
  {% endif %}

  {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
    </li>
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
    </li>
  {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
    </li>
    <li class="page-item disabled">
      <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
    </li>
  {% endif %}
  </ul>
</nav>
<!--End of pagination-->

      </div>
    </div>
  </div>
  </div>

</main>

{% endblock %}